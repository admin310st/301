# Redirects ‚Äî –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –¥–ª—è 301.st

## –û–±–∑–æ—Ä

–†–µ–¥–∏—Ä–µ–∫—Ç—ã (301/302) ‚Äî –∫–ª—é—á–µ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ –∏ SEO.

**–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–æ–º–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–Ω–æ–π —Å–µ—Ç—å—é ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—ã–π
- SEO canonical (www ‚Üî non-www)
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –¥–æ–º–µ–Ω–æ–≤
- Maintenance mode
- –°–æ–∑–¥–∞—ë—Ç—Å—è –≤ –∑–æ–Ω–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –ª—é–±—É—é –∑–æ–Ω—É/–≤–Ω–µ—à–Ω–∏–π –¥–æ–º–µ–Ω.

**–í–∞–∂–Ω–æ:** –ò–∑–±–µ–≥–∞–π—Ç–µ DNS-—Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ (CNAME/A) ‚Äî –æ–Ω–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è HTTP-—Ä–µ–¥–∏—Ä–µ–∫—Ç–∞–º–∏ –∏ –≤—Ä–µ–¥–Ω—ã –¥–ª—è SEO.

---

## –ü–æ–¥—Ö–æ–¥—ã –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. Single Redirects (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å–ª—É—á–∞–µ–≤)

**–ì–¥–µ:** `Rules ‚Üí Redirect Rules`

**–õ–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º:**

| –ü–ª–∞–Ω | –ü—Ä–∞–≤–∏–ª –Ω–∞ –∑–æ–Ω—É | Wildcard | Regex |
|------|----------------|----------|-------|
| Free | 10 | ‚úÖ | ‚ùå |
| Pro | 25 | ‚úÖ | ‚ùå |
| Business | 50 | ‚úÖ | ‚úÖ |
| Enterprise | 300 | ‚úÖ | ‚úÖ |

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- HTTP-—Ä–µ–¥–∏—Ä–µ–∫—Ç—ã (301/302) –Ω–∞ –æ—Å–Ω–æ–≤–µ: Hostname, Path
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç wildcard (`*`), –Ω–æ **–Ω–µ regex** (Free/Pro)
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ URL-—Ü–µ–ª–∏

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ùå –£—Å–ª–æ–≤–∏—è –ø–æ `http.user_agent` ‚Äî –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- ‚ùå –£—Å–ª–æ–≤–∏—è –ø–æ `ip.geoip.country` ‚Äî –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- ‚ùå –£—Å–ª–æ–≤–∏—è –ø–æ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∞–º ‚Äî –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
- ‚ùå Regex-–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ (`/user/123` ‚Üí `/profile?id=123`) ‚Äî —Ç–æ–ª—å–∫–æ Business+

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- Proxy = ON (–æ—Ä–∞–Ω–∂–µ–≤–æ–µ –æ–±–ª–∞–∫–æ) –Ω–∞ DNS-–∑–∞–ø–∏—Å–∏

**–ü—Ä–∏–º–µ—Ä API-–∑–∞–ø—Ä–æ—Å–∞:**
```json
POST https://api.cloudflare.com/client/v4/zones/{zone_id}/rulesets
{
  "name": "redirects",
  "kind": "zone",
  "phase": "http_request_dynamic_redirect",
  "rules": [{
    "expression": "http.host eq \"old.example.com\"",
    "action": "redirect",
    "action_parameters": {
      "from_value": {
        "status_code": 301,
        "target_url": {
          "expression": "concat(\"https://new.example.com\", http.request.uri.path)"
        },
        "preserve_query_string": true
      }
    }
  }]
}
```

---

### 2. Bulk Redirects (–¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤)

**–ì–¥–µ:** `Rules ‚Üí Bulk Redirects` (account-level)

**–õ–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º:**

| –ü–ª–∞–Ω | –ü—Ä–∞–≤–∏–ª | –°–ø–∏—Å–∫–æ–≤ | URL-—Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ |
|------|--------|---------|----------------|
| Free | 15 | 5 | 10,000 |
| Pro | 15 | 5 | 25,000 |
| Business | 15 | 5 | 50,000 |
| Enterprise | 50 | 25 | 1,000,000 |

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ú–∞—Å—Å–æ–≤—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã (CSV-–∏–º–ø–æ—Ä—Ç)
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —É—Å–ª–æ–≤–∏—è –ø–æ `ip.src.country` –≤ expression –ø—Ä–∞–≤–∏–ª–∞

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- ‚ùå –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ URL-—Ü–µ–ª–∏
- ‚ùå Regex –∏ string replacement

---

### 3. Workers / Snippets (–¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏)

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**
- –£—Å–ª–æ–≤–∏—è –ø–æ User-Agent (mobile redirect, bot detection)
- –£—Å–ª–æ–≤–∏—è –ø–æ Geo (country, region)
- –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (geo + device + time)
- Kill-switch (204 No Content)
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ª–æ–≥–∏–∫–∞ (A/B —Ç–µ—Å—Ç—ã —Å –≤–µ—Å–∞–º–∏)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ —Ç—Ä–∞—Ç–∏—Ç –ª–∏–º–∏—Ç Single Redirects
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å: regex, cookies, headers
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–º–µ–Ω–æ–≤

**–õ–∏–º–∏—Ç—ã Workers (Free):**
- 100,000 –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å
- 10ms CPU time

---

### 4. Page Rules (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

- **–õ–∏–º–∏—Ç:** 3 –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ Free ‚Äî —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ
- **–°—Ç–∞—Ç—É—Å:** Deprecated, –º–∏–≥—Ä–∏—Ä—É–π—Ç–µ –Ω–∞ Redirect Rules

---

## –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–æ–≤ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

### ‚úÖ –ù–∞—Å—Ç–æ—è—â–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã (Single Redirects)

**(Free Plan, –¥–æ 10 –ø—Ä–∞–≤–∏–ª –Ω–∞ –∑–æ–Ω—É)**

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ | CF | 301.st |
|----|----------|------------|:--:|:------:|
| T1 | Domain ‚Üí Domain | –û—Å–Ω–æ–≤–Ω–æ–π –∫–µ–π—Å (–¥–æ–Ω–æ—Ä ‚Üí –ª–µ–Ω–¥–∏–Ω–≥) | ‚úÖ | ‚úÖ |
| T2 | HTTP ‚Üí HTTPS | CF –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —Ä—É—á–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞–¥—ë–∂–Ω–µ–µ | ‚úÖ | ‚ö†Ô∏è |
| T3 | non-www ‚Üí www | SEO canonical | ‚úÖ | ‚úÖ |
| T4 | www ‚Üí non-www | SEO canonical | ‚úÖ | ‚úÖ |
| T5 | Path prefix ‚Üí Path | Wildcard (`/old/*`), –Ω–æ –±–µ–∑ regex | ‚úÖ | ‚úÖ |
| T6 | Exact path ‚Üí URL | A/B-—Ç–µ—Å—Ç—ã, —Ç–æ—á–µ—á–Ω—ã–µ –∑–∞–º–µ–Ω—ã | ‚úÖ | ‚úÖ |
| T7 | Maintenance redirect | –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç–∞—Ç—É—Å-—Å—Ç—Ä–∞–Ω–∏—Ü—É | ‚úÖ | ‚úÖ |

> **–õ–µ–≥–µ–Ω–¥–∞:** CF = –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Cloudflare, 301.st = —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
> - ‚úÖ ‚Äî –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
> - ‚ö†Ô∏è ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ (T2: CF –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∏–∑–±—ã—Ç–æ—á–Ω–æ)

---

### üîÑ –ú–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (—á–∞—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ URL-—Ü–µ–ª–∏)

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –°–∏–Ω—Ç–∞–∫—Å–∏—Å | –°—Ç–∞—Ç—É—Å | CF | 301.st |
|----|----------|-----------|--------|:--:|:------:|
| T8 | Preserve query | `{?}` –≤ –∫–æ–Ω—Ü–µ URL | ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∞—Ä–±–∏—Ç—Ä–∞–∂–∞ | ‚úÖ | ‚úÖ |
| T9 | Drop query | –±–µ–∑ `{?}` | ‚õî –†–µ–¥–∫–æ ‚Äî UTM/click_id –∫—Ä–∏—Ç–∏—á–Ω—ã | ‚úÖ | ‚ö†Ô∏è |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** T9 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è CF, –Ω–æ –≤ 301.st –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ–º query (T8)

---

### ‚ùå –ù–µ Single Redirects (—Ç—Ä–µ–±—É—é—Ç Worker/Snippets)

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|----|----------|---------|
| T10 | User-Agent redirect | `http.user_agent` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| T11 | Mobile redirect | `http.user_agent contains "mobi"` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| T12 | Geo redirect | `ip.geoip.country` –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| T13 | Kill-switch | `about:blank` –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º ‚Äî –Ω—É–∂–µ–Ω Worker —Å `204 No Content` |

---

## –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —à–∞–±–ª–æ–Ω–æ–≤: IF ‚Üí THEN

### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É

- `{http.request.uri.path}` ‚Äî –ø—É—Ç—å –±–µ–∑ query string
- `{?}` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç `?<query>` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏
- –í—Å–µ —É—Å–ª–æ–≤–∏—è **—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É** (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `lower()` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

---

### T1: Domain ‚Üí Domain

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | IF (Expression) | THEN (Target) | Code | –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å |
|---------|----------|-----------------|---------------|------|--------------|
| **T1a** | Preserve path + query | `http.host eq "source.com"` | `https://target.com{http.request.uri.path}{?}` | 301/302 | –î–æ–Ω–æ—Ä ‚Üí –ª–µ–Ω–¥–∏–Ω–≥ (–æ—Å–Ω–æ–≤–Ω–æ–π) |
| **T1b** | All to root | `http.host eq "source.com"` | `https://target.com/` | 301/302 | –í–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –≥–ª–∞–≤–Ω—É—é |
| **T1c** | To external URL | `http.host eq "source.com"` | `https://partner.com/offer123{?}` | 301/302 | –î–æ–Ω–æ—Ä ‚Üí –≤–Ω–µ—à–Ω–∏–π –ø–∞—Ä—Ç–Ω—ë—Ä |
| **T1d** | Subdomain catch-all | `http.host eq "*.source.com"` | `https://target.com{http.request.uri.path}{?}` | 301/302 | –í—Å–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã ‚Üí target |

**–ü—Ä–∏–º–µ—Ä—ã T1a:**
| –ò—Å—Ö–æ–¥–Ω—ã–π URL | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|--------------|-----------|
| `source.com/` | `target.com/` |
| `source.com/offer` | `target.com/offer` |
| `source.com/offer?utm_source=fb&click_id=123` | `target.com/offer?utm_source=fb&click_id=123` |

---

### T2: HTTP ‚Üí HTTPS

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | IF (Expression) | THEN (Target) | Code | –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å |
|---------|----------|-----------------|---------------|------|--------------|
| **T2a** | Force HTTPS (all) | `http.request.scheme eq "http"` | `https://{http.host}{http.request.uri.path}{?}` | 301 | –í–µ—Å—å —Å–∞–π—Ç |
| **T2b** | Force HTTPS (path) | `http.request.scheme eq "http" and starts_with(http.request.uri.path, "/admin")` | `https://{http.host}{http.request.uri.path}{?}` | 301 | –¢–æ–ª—å–∫–æ /admin/* |

> ‚ö†Ô∏è CF –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (Always Use HTTPS), –Ω–æ —Ä—É—á–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–∞—ë—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å.

---

### T3: non-www ‚Üí www

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | IF (Expression) | THEN (Target) | Code | –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å |
|---------|----------|-----------------|---------------|------|--------------|
| **T3a** | Apex to www | `http.host eq "example.com"` | `https://www.example.com{http.request.uri.path}{?}` | 301 | SEO canonical |

**–ü—Ä–∏–º–µ—Ä—ã:**
| –ò—Å—Ö–æ–¥–Ω—ã–π URL | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|--------------|-----------|
| `example.com/` | `www.example.com/` |
| `example.com/page?id=1` | `www.example.com/page?id=1` |

---

### T4: www ‚Üí non-www

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | IF (Expression) | THEN (Target) | Code | –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å |
|---------|----------|-----------------|---------------|------|--------------|
| **T4a** | www to apex | `http.host eq "www.example.com"` | `https://example.com{http.request.uri.path}{?}` | 301 | SEO canonical |

---

### T5: Path prefix ‚Üí Path

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | IF (Expression) | THEN (Target) | Code | –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å |
|---------|----------|-----------------|---------------|------|--------------|
| **T5a** | Prefix to new path (same domain) | `http.host eq "example.com" and starts_with(http.request.uri.path, "/old/")` | `https://example.com/new/{?}` | 301/302 | –í—Å–µ `/old/*` ‚Üí `/new/` |
| **T5b** | Prefix to other domain | `http.host eq "old.com" and starts_with(http.request.uri.path, "/blog/")` | `https://blog.new.com/{?}` | 301/302 | –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–∞–∑–¥–µ–ª–∞ |
| **T5c** | Remove locale prefix | `http.host eq "example.com" and starts_with(http.request.uri.path, "/en/")` | `https://example.com/{?}` | 301 | `/en/page` ‚Üí `/page` |

> ‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** Wildcard —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–∞—Å—Ç—å –ø—É—Ç–∏ –ø–æ—Å–ª–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞. `/old/page1` ‚Üí `/new/page1` —Ç—Ä–µ–±—É–µ—Ç Worker.

---

### T6: Exact path ‚Üí URL

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | IF (Expression) | THEN (Target) | Code | –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å |
|---------|----------|-----------------|---------------|------|--------------|
| **T6a** | Path to path (same domain) | `http.host eq "example.com" and http.request.uri.path eq "/old-page"` | `https://example.com/new-page{?}` | 301/302 | –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã |
| **T6b** | Path to other domain | `http.host eq "example.com" and http.request.uri.path eq "/partner"` | `https://partner.com/landing{?}` | 301/302 | –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è —Å—Å—ã–ª–∫–∞ |
| **T6c** | Path to URL (drop query) | `http.host eq "example.com" and http.request.uri.path eq "/redirect"` | `https://target.com/fixed` | 302 | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π target |

**–ü—Ä–∏–º–µ—Ä—ã T6a:**
| –ò—Å—Ö–æ–¥–Ω—ã–π URL | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|--------------|-----------|
| `example.com/old-page` | `example.com/new-page` |
| `example.com/old-page?ref=abc` | `example.com/new-page?ref=abc` |

---

### T7: Maintenance redirect

| –í–∞—Ä–∏–∞–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | IF (Expression) | THEN (Target) | Code | –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å |
|---------|----------|-----------------|---------------|------|--------------|
| **T7a** | All to status page | `http.host eq "example.com"` | `https://status.example.com/maintenance` | **302** | –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ |
| **T7b** | Except status page | `http.host eq "example.com" and not starts_with(http.request.uri.path, "/status")` | `https://example.com/status` | **302** | Maintenance —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º |

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **302** (temporary), –Ω–µ 301 ‚Äî –∏–Ω–∞—á–µ –±—Ä–∞—É–∑–µ—Ä—ã –∑–∞–∫–µ—à–∏—Ä—É—é—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç.

---

## –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

| ID | Source Pattern | Preserve Path | Preserve Query | Default Code | –õ–∏–º–∏—Ç |
|----|----------------|---------------|----------------|--------------|-------|
| T1a | `domain/*` | ‚úÖ | ‚úÖ | 301 | 1 |
| T1b | `domain/*` | ‚ùå | ‚ùå | 301 | 1 |
| T1c | `domain/*` | ‚ùå | ‚úÖ | 301 | 1 |
| T1d | `*.domain/*` | ‚úÖ | ‚úÖ | 301 | 1 |
| T2a | `http://domain/*` | ‚úÖ | ‚úÖ | 301 | 1 |
| T2b | `http://domain/path/*` | ‚úÖ | ‚úÖ | 301 | 1 |
| T3a | `domain/*` (non-www) | ‚úÖ | ‚úÖ | 301 | 1 |
| T4a | `www.domain/*` | ‚úÖ | ‚úÖ | 301 | 1 |
| T5a | `domain/prefix/*` | ‚ùå | ‚úÖ | 301 | 1 |
| T5b | `domain/prefix/*` | ‚ùå | ‚úÖ | 301 | 1 |
| T5c | `domain/locale/*` | ‚ùå | ‚úÖ | 301 | 1 |
| T6a | `domain/exact-path` | ‚ùå | ‚úÖ | 301 | 1 |
| T6b | `domain/exact-path` | ‚ùå | ‚úÖ | 301 | 1 |
| T6c | `domain/exact-path` | ‚ùå | ‚ùå | 302 | 1 |
| T7a | `domain/*` | ‚ùå | ‚ùå | **302** | 1 |
| T7b | `domain/*` (except) | ‚ùå | ‚ùå | **302** | 1 |

---

## Worker/Snippets —à–∞–±–ª–æ–Ω—ã (T10-T13)

–≠—Ç–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ **–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è** –≤ Single Redirects –∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Worker.

### T10: User-Agent redirect

```javascript
export default {
  async fetch(request) {
    const ua = request.headers.get('User-Agent') || '';
    if (/bot|crawler|spider/i.test(ua)) {
      return Response.redirect('https://safe.example.com/', 302);
    }
    return fetch(request);
  }
}
```

### T11: Mobile redirect

```javascript
export default {
  async fetch(request) {
    const ua = request.headers.get('User-Agent') || '';
    if (/mobile|android|iphone/i.test(ua)) {
      const url = new URL(request.url);
      return Response.redirect(`https://m.example.com${url.pathname}${url.search}`, 302);
    }
    return fetch(request);
  }
}
```

### T12: Geo redirect

```javascript
export default {
  async fetch(request) {
    const country = request.cf?.country || 'XX';
    const url = new URL(request.url);

    const geoTargets = {
      'RU': 'https://ru.example.com',
      'UA': 'https://ua.example.com',
      'DE': 'https://de.example.com'
    };

    if (geoTargets[country]) {
      return Response.redirect(`${geoTargets[country]}${url.pathname}${url.search}`, 302);
    }
    return fetch(request);
  }
}
```

### T13: Kill-switch (204 No Content)

```javascript
export default {
  async fetch(request) {
    // –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç
    return new Response(null, { status: 204 });
  }
}
```

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è 301.st

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Single Redirects:
- ‚úÖ T1-T7 ‚Äî –ø—Ä–æ—Å—Ç—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã
- ‚úÖ –î–æ 10 –ø—Ä–∞–≤–∏–ª –Ω–∞ –∑–æ–Ω—É (Free)
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ –ø–æ geo/UA/headers

### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Worker:
- ‚úÖ T10-T13 ‚Äî —É—Å–ª–æ–≤–∏—è –ø–æ User-Agent, Geo
- ‚úÖ –ë–æ–ª–µ–µ 10 —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –Ω–∞ –∑–æ–Ω—É
- ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –ª–æ–≥–∏–∫–∞ (A/B —Ç–µ—Å—Ç—ã, —Ä–æ—Ç–∞—Ü–∏—è)
- ‚úÖ Kill-switch

### –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
1. **–í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ `{?}`** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è UTM –∏ click_id
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 302 –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤** (maintenance)
3. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ Proxy = ON** –Ω–∞ DNS-–∑–∞–ø–∏—Å–∏
4. **–ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –ª–∏–º–∏—Ç—ã –≤ UI:** ¬´–û—Å—Ç–∞–ª–æ—Å—å X –∏–∑ 10 —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤¬ª

---

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Cloudflare API

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª

```bash
GET https://api.cloudflare.com/client/v4/zones/{zone_id}/rulesets?phase=http_request_dynamic_redirect
```

### –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞

```bash
POST https://api.cloudflare.com/client/v4/zones/{zone_id}/rulesets/{ruleset_id}/rules
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞

```bash
PATCH https://api.cloudflare.com/client/v4/zones/{zone_id}/rulesets/{ruleset_id}/rules/{rule_id}
```

### –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞

```bash
DELETE https://api.cloudflare.com/client/v4/zones/{zone_id}/rulesets/{ruleset_id}/rules/{rule_id}
```

## –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏

- **Domains** ‚Äî —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –¥–æ–º–µ–Ω—É (donor role)
- **Sites** ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –ø–æ —Å–∞–π—Ç–∞–º
- **TDS** ‚Äî —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ (T10-T13) –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ TDS-–º–æ–¥—É–ª—å
- **Analytics** ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è (Templates/Presets –≤ –∫–æ–¥–µ, Rules –≤ D1)
- –ü—Ä–∏–≤—è–∑–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∫ –¥–æ–º–µ–Ω—É (–Ω–µ –∫ Site)
- Analytics —á–µ—Ä–µ–∑ CF GraphQL API + –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫
- Batch job 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

 # Redirects Module ‚Äî –§–∏–Ω–∞–ª—å–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

## 1. –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å Redirects —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Å—Ç—ã–º–∏ HTTP-—Ä–µ–¥–∏—Ä–µ–∫—Ç–∞–º–∏ (301/302) —á–µ—Ä–µ–∑ Cloudflare Single Redirects API.

**–ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
-  –†–µ–¥–∏—Ä–µ–∫—Ç—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ **Domain** (–Ω–µ –∫ Site)
-  Templates (T1-T7) –∏ Presets (P1-Pn) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **–∫–æ–¥–µ** (constants)
-  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ **D1** (redirect_rules)
-  Analytics —á–µ—Ä–µ–∑ CF GraphQL API + –Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫
-  Batch job 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 2.1 –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ö–û–î (src/constants/redirects/)                                  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ templates.ts    ‚Äî T1-T7 (CF expressions, defaults)              ‚îÇ
‚îÇ presets.ts      ‚Äî P1-Pn (–∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤)                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ D1 DATABASE                                                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ redirect_rules  ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ + analytics          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ CLOUDFLARE (–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∞–∫–∫–∞—É–Ω—Ç)                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Redirect Rules  ‚Äî –ø—Ä–∞–≤–∏–ª–∞ –≤ –∑–æ–Ω–µ (phase: http_request_dynamic_redirect) ‚îÇ
‚îÇ GraphQL API     ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ 3xx –æ—Ç–≤–µ—Ç–æ–≤                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2.2 –ò–µ—Ä–∞—Ä—Ö–∏—è –¥–∞–Ω–Ω—ã—Ö

```
Account
  ‚îî‚îÄ‚îÄ Project
        ‚îî‚îÄ‚îÄ Site (–ª–æ–≥–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∞)
              ‚îî‚îÄ‚îÄ Domain ‚Üê —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø—Ä–∏–≤—è–∑–∞–Ω —Å—é–¥–∞
                    ‚îî‚îÄ‚îÄ Zone (CF) ‚Üê –ø—Ä–∞–≤–∏–ª–æ –¥–µ–ø–ª–æ–∏—Ç—Å—è —Å—é–¥–∞
```

**–í–∞–∂–Ω–æ:**
- –†–µ–¥–∏—Ä–µ–∫—Ç = –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞-–∏—Å—Ç–æ—á–Ω–∏–∫–∞
- CF Redirect Rule —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ **–∑–æ–Ω–µ** –¥–æ–º–µ–Ω–∞
- –õ–∏–º–∏—Ç 10 –ø—Ä–∞–≤–∏–ª —Å—á–∏—Ç–∞–µ—Ç—Å—è **per zone**
- Site –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ UI

---

## 3. Templates (T1-T7)

–®–∞–±–ª–æ–Ω—ã ‚Äî —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ CF expressions. –•—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–¥–µ.

### 3.1 –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|----|----------|-----------|----------|
| T1 | Domain ‚Üí Domain | domain | –û—Å–Ω–æ–≤–Ω–æ–π –∫–µ–π—Å (–¥–æ–Ω–æ—Ä ‚Üí –ª–µ–Ω–¥–∏–Ω–≥) |
| T3 | non-www ‚Üí www | canonical | SEO canonical |
| T4 | www ‚Üí non-www | canonical | SEO canonical |
| T5 | Path prefix ‚Üí Path | path | Wildcard `/old/*` ‚Üí `/new/` |
| T6 | Exact path ‚Üí URL | path | –¢–æ—á–µ—á–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã |
| T7 | Maintenance | temporary | –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç |

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** T2 (HTTP‚ÜíHTTPS) –∏—Å–∫–ª—é—á—ë–Ω ‚Äî CF –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### 3.2 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —à–∞–±–ª–æ–Ω–æ–≤

| ID | –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã | Preserve Path | Preserve Query | Default Code |
|----|-------------------------|---------------|----------------|--------------|
| T1 | target_url | ‚úÖ | ‚úÖ | 301 |
| T3 | ‚Äî (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω) | ‚úÖ | ‚úÖ | 301 |
| T4 | ‚Äî (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω) | ‚úÖ | ‚úÖ | 301 |
| T5 | source_path, target_path | ‚ùå | ‚úÖ | 301 |
| T6 | source_path, target_url | ‚ùå | ‚úÖ | 301 |
| T7 | target_url | ‚ùå | ‚ùå | **302** |

### 3.3 CF Expressions

```typescript
// T1: Domain ‚Üí Domain
{
  expression: 'http.host eq "{source_domain}"',
  target: 'concat("https://{target_domain}", http.request.uri.path)',
  preserve_query: true
}

// T3: non-www ‚Üí www
{
  expression: 'http.host eq "{domain}"',
  target: 'concat("https://www.{domain}", http.request.uri.path)',
  preserve_query: true
}

// T4: www ‚Üí non-www
{
  expression: 'http.host eq "www.{domain}"',
  target: 'concat("https://{domain}", http.request.uri.path)',
  preserve_query: true
}

// T5: Path prefix ‚Üí Path
{
  expression: 'http.host eq "{domain}" and starts_with(http.request.uri.path, "{source_path}")',
  target: '"https://{domain}{target_path}"',
  preserve_query: true
}

// T6: Exact path ‚Üí URL
{
  expression: 'http.host eq "{domain}" and http.request.uri.path eq "{source_path}"',
  target: '"{target_url}"',
  preserve_query: true
}

// T7: Maintenance
{
  expression: 'http.host eq "{domain}"',
  target: '"{target_url}"',
  preserve_query: false,
  status_code: 302  // –í–ê–ñ–ù–û: –≤—Å–µ–≥–¥–∞ 302
}
```

---

## 4. Presets (P1-Pn)

–ü—Ä–µ—Å–µ—Ç—ã ‚Äî –≥–æ—Ç–æ–≤—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤. –•—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–¥–µ.

| ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –°–æ—Å—Ç–∞–≤ | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ |
|----|----------|--------|------------|
| P1 | SEO Canonical (www) | T3 | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SEO |
| P2 | SEO Canonical (non-www) | T4 | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π SEO |
| P3 | Domain Migration | T1 + T3 | –ü–µ—Ä–µ–µ–∑–¥ –¥–æ–º–µ–Ω–∞ —Å www-—Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º |
| P4 | Maintenance Mode | T7 | –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ |
| P5 | Full Migration | T1 + T3 + T5 (√óN) | –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–µ–∑–¥ —Å –ø—É—Ç—è–º–∏ |

---

## 5. Database Schema

### 5.1 –¢–∞–±–ª–∏—Ü–∞ redirect_rules

```sql
CREATE TABLE IF NOT EXISTS redirect_rules (
    id INTEGER PRIMARY KEY AUTOINCREMENT,

    -- –í–ª–∞–¥–µ–ª–µ—Ü –∏ —Å–≤—è–∑–∏
    account_id INTEGER NOT NULL,
    domain_id INTEGER NOT NULL,              -- –î–æ–º–µ–Ω-–∏—Å—Ç–æ—á–Ω–∏–∫
    zone_id INTEGER NOT NULL,                -- –ó–æ–Ω–∞ CF (–¥–ª—è –ª–∏–º–∏—Ç–æ–≤)

    -- –®–∞–±–ª–æ–Ω –∏ –ø—Ä–µ—Å–µ—Ç
    template_id TEXT NOT NULL,               -- T1, T3, T4, T5, T6, T7
    preset_id TEXT,                          -- P1-Pn (nullable)
    preset_order INTEGER,                    -- –ü–æ—Ä—è–¥–æ–∫ –≤ –ø—Ä–µ—Å–µ—Ç–µ

    -- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∞–≤–∏–ª–∞
    rule_name TEXT NOT NULL,
    params TEXT NOT NULL DEFAULT '{}',       -- JSON —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    status_code INTEGER NOT NULL DEFAULT 301
        CHECK(status_code IN (301, 302)),

    -- –°–æ—Å—Ç–æ—è–Ω–∏–µ
    enabled INTEGER NOT NULL DEFAULT 1,

    -- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Cloudflare
    sync_status TEXT NOT NULL DEFAULT 'pending'
        CHECK(sync_status IN ('pending', 'synced', 'error')),
    cf_rule_id TEXT,
    cf_ruleset_id TEXT,
    last_synced_at TEXT,
    last_error TEXT,

    -- Analytics (–Ω–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏)
    clicks_total INTEGER NOT NULL DEFAULT 0,
    clicks_yesterday INTEGER NOT NULL DEFAULT 0,
    clicks_today INTEGER NOT NULL DEFAULT 0,
    last_counted_date TEXT,                  -- YYYY-MM-DD

    -- Timestamps
    created_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TEXT NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- Foreign Keys
    FOREIGN KEY (account_id) REFERENCES accounts(id) ON DELETE CASCADE,
    FOREIGN KEY (domain_id) REFERENCES domains(id) ON DELETE CASCADE,
    FOREIGN KEY (zone_id) REFERENCES zones(id) ON DELETE CASCADE
);
```

### 5.2 –ò–Ω–¥–µ–∫—Å—ã

```sql
-- –í—ã–±–æ—Ä–∫–∞ –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É
CREATE INDEX idx_redirect_rules_account ON redirect_rules(account_id);

-- –ü–æ–¥—Å—á—ë—Ç –ª–∏–º–∏—Ç–æ–≤ per zone
CREATE INDEX idx_redirect_rules_zone_enabled ON redirect_rules(zone_id, enabled);

-- –í—ã–±–æ—Ä–∫–∞ –ø–æ –¥–æ–º–µ–Ω—É
CREATE INDEX idx_redirect_rules_domain ON redirect_rules(domain_id);

-- Batch job —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
CREATE INDEX idx_redirect_rules_sync_pending ON redirect_rules(sync_status)
    WHERE sync_status = 'pending';

-- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–µ—Å–µ—Ç–∞–º
CREATE INDEX idx_redirect_rules_preset ON redirect_rules(account_id, preset_id, preset_order)
    WHERE preset_id IS NOT NULL;

-- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å: –æ–¥–∏–Ω template –Ω–∞ –¥–æ–º–µ–Ω
CREATE UNIQUE INDEX idx_redirect_rules_unique ON redirect_rules(domain_id, template_id)
    WHERE enabled = 1;
```

### 5.3 –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø–∏—Å–µ–π

**–û–¥–∏–Ω–æ—á–Ω—ã–π —à–∞–±–ª–æ–Ω T1:**
```json
{
  "id": 1,
  "domain_id": 45,
  "template_id": "T1",
  "preset_id": null,
  "rule_name": "cryptoboss.pics ‚Üí cryptoboss.com",
  "params": {
    "target_url": "https://cryptoboss.com"
  },
  "status_code": 301,
  "enabled": 1,
  "sync_status": "synced",
  "clicks_total": 12847
}
```

**–ü—Ä–µ—Å–µ—Ç P3 (2 –ø—Ä–∞–≤–∏–ª–∞):**
```json
// –ü—Ä–∞–≤–∏–ª–æ 1
{
  "id": 2,
  "domain_id": 45,
  "template_id": "T1",
  "preset_id": "P3",
  "preset_order": 1,
  "rule_name": "Domain Migration (1/2)",
  "params": {"target_url": "https://new.com"}
}

// –ü—Ä–∞–≤–∏–ª–æ 2
{
  "id": 3,
  "domain_id": 45,
  "template_id": "T3",
  "preset_id": "P3",
  "preset_order": 2,
  "rule_name": "Domain Migration (2/2)",
  "params": {}
}
```

---

## 6. Analytics

### 6.1 –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

- CF GraphQL Analytics API
- Dataset: `httpRequestsAdaptiveGroups`
- Filter: `edgeResponseStatus` 300-399
- Group by: `clientRequestHTTPHost`

### 6.2 –õ–∏–º–∏—Ç—ã Free Plan

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Free | Pro | Business |
|----------|------|-----|----------|
| Data retention | **3 –¥–Ω—è** | 30 –¥–Ω–µ–π | 90 –¥–Ω–µ–π |
| API calls/day | ~1000 | ~10000 | ~100000 |

### 6.3 –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫

–ß—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ 3-–¥–Ω–µ–≤–Ω–æ–≥–æ retention:

**Batch job (1 —Ä–∞–∑ –≤ –¥–µ–Ω—å):**
1. Query CF GraphQL API –∑–∞ –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞:
   - `clicks_total += clicks_from_cf`
   - `clicks_yesterday = clicks_today`
   - `clicks_today = 0`
   - `last_counted_date = today`

**–ü–æ–ª—è –≤ redirect_rules:**
| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| clicks_total | –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ (–≤—Å—ë –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏) |
| clicks_yesterday | –ö–ª–∏–∫–∏ –∑–∞ –≤—á–µ—Ä–∞ (–¥–ª—è trend) |
| clicks_today | –ö–ª–∏–∫–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è |
| last_counted_date | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–¥—Å—á—ë—Ç–∞ |

### 6.4 Trend calculation

```javascript
const trend = clicks_today > clicks_yesterday * 1.1 ? 'up'
            : clicks_today < clicks_yesterday * 0.9 ? 'down'
            : 'neutral';
```

---

## 7. UI Flow

### 7.1 –ù–∞–≤–∏–≥–∞—Ü–∏—è

```
Projects ‚Üí Site ‚Üí Redirects
```

### 7.2 List View

**Header:**
- –ù–∞–∑–≤–∞–Ω–∏–µ Site
- –ö–Ω–æ–ø–∫–∞ [+ New Redirect]
- –§–∏–ª—å—Ç—Ä –ø–æ –¥–æ–º–µ–Ω—É
- Zone Limits (per zone)

**–¢–∞–±–ª–∏—Ü–∞:**
| Status | Domain | Target | Type | Code | Clicks | Trend | Sync | Actions |
|--------|--------|--------|------|------|--------|-------|------|---------|

### 7.3 Create/Edit Drawer

1. Source Domain (select + –ª–∏–º–∏—Ç)
2. Template (T1-T7) –∏–ª–∏ Preset (P1-Pn)
3. Parameters (–∑–∞–≤–∏—Å—è—Ç –æ—Ç template)
4. Status Code (301/302)
5. Preview (CF expression)
6. Save & Deploy

### 7.4 Sync Status

| Status | Badge | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|-------|----------|
| synced | ‚úÖ Synced | –ü—Ä–∞–≤–∏–ª–æ –∞–∫—Ç–∏–≤–Ω–æ –≤ CF |
| pending | ‚è≥ Pending | –û–∂–∏–¥–∞–µ—Ç –¥–µ–ø–ª–æ—è |
| error | ‚ùå Error | –û—à–∏–±–∫–∞ CF API |

---

## 8. Validation

| –ü—Ä–∞–≤–∏–ª–æ | –°–æ–æ–±—â–µ–Ω–∏–µ |
|---------|-----------|
| Zone limit | "Zone limit reached (10/10)" |
| Duplicate template | "This template already exists for this domain" |
| Invalid URL | "Target must be a valid HTTPS URL" |
| Path format | "Path must start with /" |

---

## 9. Scope & Exclusions

### –í scope:
- ‚úÖ Simple redirects (T1-T7)
- ‚úÖ CF Single Redirects API
- ‚úÖ Analytics via CF GraphQL API
- ‚úÖ –ù–∞–∫–æ–ø–∏—Ç–µ–ª—å–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–∏

### –í–Ω–µ scope (TDS module):
- ‚ùå Geo redirects (T12)
- ‚ùå User-Agent redirects (T10, T11)
- ‚ùå Kill-switch (T13)
- ‚ùå A/B testing with weights
- ‚ùå Workers-based redirects

---

## 10. Implementation Plan

1. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î** ‚Äî —Å–æ–∑–¥–∞—Ç—å redirect_rules
2. **API –¥–ª—è UI** ‚Äî CRUD endpoints
3. **Templates/Presets** ‚Äî constants –≤ –∫–æ–¥–µ
4. **CF Integration** ‚Äî –¥–µ–ø–ª–æ–π –ø—Ä–∞–≤–∏–ª –≤ –∑–æ–Ω—É
5. **Analytics** ‚Äî batch job + GraphQL API
