# ============================================================
# 301 TDS Worker Configuration Template
# ============================================================
#
# Traffic Distribution System (TDS) worker for redirect rules.
#
# Copy to wrangler.toml and fill in values.
#
# Deploy:
#   npx wrangler deploy
#
# Secrets (set via wrangler secret put or POST /workers/config/tds/setup):
#   wrangler secret put JWT_TOKEN       # JWT for API auth
#   wrangler secret put ACCOUNT_ID      # 301.st account ID
#
# ============================================================

name = "301-tds"
main = "index.ts"
compatibility_date = "2025-01-01"

# ============================================================
# Variables
# ============================================================

[vars]
API_URL = "https://301.st"
# RULES_CACHE_TTL = "300"  # Cache TTL in seconds (default: 5 min)

# ============================================================
# D1 Database (for caching rules)
# ============================================================

[[d1_databases]]
binding = "DB"
database_name = "301-tds"
database_id = "YOUR_DATABASE_ID_HERE"

# ============================================================
# Routes
# ============================================================
#
# Each route binds this worker to a domain pattern.
# Worker code uses hostname to determine which TDS rules apply.
#
# Example:
# routes = [
#   { pattern = "brand-us.com/*", zone_name = "brand-us.com" },
#   { pattern = "brand-ru.org/*", zone_name = "brand-ru.org" },
#   { pattern = "offer.brand-eu.net/*", zone_name = "brand-eu.net" }
# ]
#
# Routes are automatically added when you assign domains to TDS.
#
# ============================================================

routes = [
  # Add routes here or via POST /workers/config/tds/routes
]

# ============================================================
# Workers.dev Access (for testing)
# ============================================================

workers_dev = true

# ============================================================
# Environment-specific overrides
# ============================================================
#
# [env.production]
# vars = { API_URL = "https://301.st" }
#
# [env.staging]
# vars = { API_URL = "https://staging.301.st" }
#
# ============================================================
