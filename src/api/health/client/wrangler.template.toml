# ============================================================
# 301 Client Worker Configuration Template
# ============================================================
#
# Скопировать в wrangler.toml и заполнить значения.
#
# Deploy:
#   npx wrangler deploy
#
# Secrets (set via wrangler secret put or POST /health/client/setup):
#   wrangler secret put VT_API_KEY      # VirusTotal API key
#   wrangler secret put JWT_TOKEN       # JWT для исходящих webhook → 301.st
#   wrangler secret put ACCOUNT_ID      # ID аккаунта в 301.st
#   wrangler secret put CF_API_TOKEN    # опционально, для phishing check
#
# ============================================================

name = "301-client"
main = "index.ts"
compatibility_date = "2025-01-01"

# ============================================================
# Variables
# ============================================================

[vars]
WEBHOOK_URL = "https://301.st/webhook/health"
# API_301_URL = "https://301.st"  # опционально, для получения списка доменов

# ============================================================
# D1 Database
# ============================================================

[[d1_databases]]
binding = "DB"
database_name = "301-client"
database_id = "YOUR_DATABASE_ID_HERE"

# ============================================================
# Cron Triggers
# ============================================================
#
# Расписание запуска:
# - "0 */12 * * *" = каждые 12 часов (0:00, 12:00)
# - "0 6,18 * * *" = в 6:00 и 18:00 UTC
# - "0 */6 * * *"  = каждые 6 часов (для большого кол-ва доменов)
#
# Выбор интервала зависит от количества активных доменов:
# - <100 доменов: */12 (2 раза в день)
# - 100-300 доменов: */8 (3 раза в день)
# - >300 доменов: */6 (4 раза в день)
#
# ============================================================

[triggers]
crons = ["0 */12 * * *"]

# ============================================================
# Routes (опционально)
# ============================================================
#
# Если нужен HTTP доступ к worker:
#
# routes = [
#   { pattern = "health.example.com/*", zone_name = "example.com" }
# ]
#
# Или через workers.dev:
# workers_dev = true
#
# ============================================================

workers_dev = true

# ============================================================
# Build Configuration
# ============================================================
#
# Если используется bundler (esbuild, etc):
#
# [build]
# command = "npm run build"
# watch_dir = "src"
#
# ============================================================

# ============================================================
# Environment-specific overrides
# ============================================================
#
# [env.production]
# vars = { WEBHOOK_URL = "https://301.st/webhook/health" }
#
# [env.staging]
# vars = { WEBHOOK_URL = "https://staging.301.st/webhook/health" }
#
# ============================================================
