name: Deploy D1 Schema

on:
  push:
    branches: [ main ]
    paths:
      - 'schema/301_d1.sql'
      - '.github/workflows/deploy_d1.yml'

jobs:
  apply-d1-schema:
    name: Apply Cloudflare D1 schema
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Wrangler
        run: npm install -g wrangler

      - name: Apply D1 schema to Cloudflare
        env:
          CF_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          CF_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
        run: |
          echo "Applying D1 schema to Cloudflare..."
          wrangler d1 execute 301 --file=schema/301_d1.sql --remote
          echo "Schema applied successfully."
